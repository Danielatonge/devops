# K8s secrets
## Prerequisites

## Steps
1. Create a secret in the cluster using `kubectl`: 
    ```bash
    $ kubectl create secret generic currentmoscowtime-secret --from-literal=username='currentmoscowtime'
    secret/currentmoscowtime-secret created
    ```
2. Verify and decode the secret, and provide the output of the commands: 
    ```bash
    $ kubectl get secret currentmoscowtime-secret                                          
   NAME                       TYPE     DATA   AGE
   currentmoscowtime-secret   Opaque   1      57s
    $ kubectl get secret currentmoscowtime-secret -o jsonpath='{.data}'
    {"username":"Y3VycmVudG1vc2Nvd3RpbWU="}%
    $ kubectl get secret currentmoscowtime-secret --template={{.data.username}} | base64 -D
    currentmoscowtime%
    ```  
3. Update your helm deployment. Get pods: `kubectl get po`. Use the name of the pod to provide a proof of your success: 
    ```bash
    $ kubectl get po
   NAME                                 READY   STATUS    RESTARTS   AGE
   currentmoscowtime-74b4bdfd68-b6v89   1/1     Running   0          9m36s

    $ kubectl exec currentmoscowtime-74b4bdfd68-b6v89 -- printenv | grep MY_USERNAME
    MY_USERNAME=currentmoscowtime 
    ```
4. Set up requests and limits for CPU and memory for the application and test that it works:
    ```bash
    $ kubectl get po
    $ kubectl get po
   NAME                                 READY   STATUS    RESTARTS   AGE
   currentmoscowtime-74b4bdfd68-b6v89   1/1     Running   0          9m36s

    $ kubectl describe po currentmoscowtime-74b4bdfd68-b6v89                       
    Name:         currentmoscowtime-74b4bdfd68-b6v89
   Namespace:    default
   Priority:     0
   Node:         minikube/192.168.99.105
   Start Time:   Mon, 27 Sep 2021 21:49:53 +0300
   Labels:       app=currentmoscowtime
                 pod-template-hash=74b4bdfd68
   Annotations:  <none>
   Status:       Running
   IP:           172.17.0.3
   IPs:
     IP:           172.17.0.3
   Controlled By:  ReplicaSet/currentmoscowtime-74b4bdfd68
   Containers:
     continuous-integration-8zk94:
       Container ID:   docker://957377c9624b0c7696ff3cda0224958b1b098605f66a7b84013155b13976f2de
       Image:          danielatonge/continuous_integration:latest
       Image ID:       docker-pullable://danielatonge/continuous_integration@sha256:a5290648d99954744d2745127e9f5a14c4d1f44330bc5362fcae3b68fe362f6a
       Port:           <none>
       Host Port:      <none>
       State:          Running
         Started:      Mon, 27 Sep 2021 21:49:56 +0300
       Ready:          True
       Restart Count:  0
       Environment:    <none>
       Mounts:
         /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-8bt7v (ro)
   Conditions:
     Type              Status
     Initialized       True 
     Ready             True 
     ContainersReady   True 
     PodScheduled      True 
   Volumes:
     kube-api-access-8bt7v:
       Type:                    Projected (a volume that contains injected data from multiple sources)
       TokenExpirationSeconds:  3607
       ConfigMapName:           kube-root-ca.crt
       ConfigMapOptional:       <nil>
       DownwardAPI:             true
   QoS Class:                   BestEffort
   Node-Selectors:              <none>
   Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                                node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
   Events:
     Type    Reason     Age   From               Message
     ----    ------     ----  ----               -------
     Normal  Scheduled  11m   default-scheduler  Successfully assigned default/currentmoscowtime-74b4bdfd68-b6v89 to minikube
     Normal  Pulling    11m   kubelet            Pulling image "danielatonge/continuous_integration:latest"
     Normal  Pulled     11m   kubelet            Successfully pulled image "danielatonge/continuous_integration:latest" in 2.080972776s
     Normal  Created    11m   kubelet            Created container continuous-integration-8zk94
     Normal  Started    11m   kubelet            Started container continuous-integration-8zk94

    ```   
                           